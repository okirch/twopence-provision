#
# This snippet takes care of enabling repositories and installing
# packages using zypper
#
set -e
for name in $TWOPENCE_ADD_REPOSITORIES; do
	eval url='$'"TWOPENCE_REPO_${name}_URL"
	eval key='$'"TWOPENCE_REPO_${name}_KEY"

	# The following would work, too; at least in bash
	# url_var="TWOPENCE_REPO_${name}_URL"
	# key_var="TWOPENCE_REPO_${name}_KEY"
	# url=${!url_var}
	# key=${!key_var}

	case $key in
	http:*|https:*)
		rpm --import $key;;
	*)
		echo "Error: Unable to handle repo key $key for repository $name" >&2
		false;;
	esac

	zypper ar $url $name
done

if [ -n "$TWOPENCE_INSTALL_PACKAGES" ]; then
	zypper in -y $TWOPENCE_INSTALL_PACKAGES
fi
set +e
